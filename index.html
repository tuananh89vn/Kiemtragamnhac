<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh chi·∫øu Ki·ªÉm tra √Çm nh·∫°c</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #ffeef8 0%, #f8e8ff 30%, #ffe8f0 70%, #fff0f8 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            border: 1px solid rgba(255, 182, 193, 0.3);
            box-shadow: 0 12px 40px 0 rgba(255, 182, 193, 0.2);
        }
        
        .fredoka {
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
        }
        
        @keyframes fadeInUp {
            0% { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes logoSpin {
            0% { transform: scale(0.5) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(0deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        @keyframes progressBar {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .logo-spin {
            animation: logoSpin 2s ease-out;
        }
        
        .progress-bar {
            animation: progressBar 3s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) rotate(0deg); }
            40% { transform: translateY(-12px) rotate(5deg); }
            60% { transform: translateY(-6px) rotate(-3deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .music-icon {
            animation: bounce 2.5s infinite;
            display: inline-block;
        }
        
        .float-icon {
            animation: float 3s ease-in-out infinite;
            display: inline-block;
        }
        
        .pulse-icon {
            animation: pulse 2s ease-in-out infinite;
            display: inline-block;
        }
        
        .sparkle-icon {
            animation: sparkle 1.5s ease-in-out infinite;
            display: inline-block;
        }
        
        .btn-hover {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .btn-hover:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(255, 182, 193, 0.4);
        }
        
        .btn-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-hover:hover::before {
            left: 100%;
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #ff6b9d, #c44569, #f8b500, #ff6b9d);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .hidden {
            display: none;
        }

        /* Th√™m style cho n√∫t Start Video */
        .start-video-btn {
            background-color: #4CAF50; /* Xanh l√° */
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.3s;
        }
        .start-video-btn:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <main class="w-full max-w-4xl">
        <!-- M√†n h√¨nh kh·ªüi ƒë·ªông -->
        <div id="loadingScreen" class="glass p-8 text-center fade-in">
            <div class="flex flex-col items-center justify-center min-h-[60vh]">
                <div class="mb-8">
                    <img src="https://i.postimg.cc/QMVXzkYz/ART-PRO-EDUCATION.jpg" 
                         alt="Art Pro Education" 
                         class="w-64 h-auto rounded-2xl shadow-2xl logo-spin mx-auto"
                         onerror="this.style.display='none';">
                </div>
                
                <div class="flex justify-center items-center mb-6">
                    <span class="sparkle-icon text-3xl mr-2">‚ú®</span>
                    <span class="music-icon text-4xl mr-2">üéµ</span>
                    <span class="float-icon text-3xl mr-2">üå∏</span>
                </div>
                
                <h1 class="text-3xl md:text-5xl fredoka gradient-text mb-4">
                    Art Pro Education
                </h1>
                
                <p class="text-pink-700 text-lg font-medium mb-8">
                    ƒêang kh·ªüi ƒë·ªông ·ª©ng d·ª•ng ki·ªÉm tra √¢m nh·∫°c...
                </p>
                
                <div class="w-64 bg-pink-100/50 rounded-full h-3 mb-4 overflow-hidden">
                    <div class="bg-gradient-to-r from-pink-400 to-rose-500 h-full rounded-full progress-bar"></div>
                </div>
                
                <div class="flex justify-center items-center gap-2">
                    <span class="pulse-icon text-xl">‚è≥</span>
                    <span class="text-pink-600 font-medium">Vui l√≤ng ch·ªù...</span>
                </div>
            </div>
        </div>

        <!-- M√†n h√¨nh ch√≠nh -->
        <div id="homeScreen" class="glass p-8 text-center fade-in">
            <header class="mb-8">
                <div class="flex justify-center items-center mb-6">
                    <span class="sparkle-icon text-2xl mr-2">‚ú®</span>
                    <span class="music-icon text-3xl mr-2">üéµ</span>
                    <span class="float-icon text-2xl mr-2">üå∏</span>
                </div>
                <h1 class="text-4xl md:text-6xl fredoka gradient-text mb-2">
                    Ki·ªÉm tra √Çm nh·∫°c
                </h1>

                <!-- Logo -->
                <div class="mb-6 flex justify-center">
                    <img src="https://i.postimg.cc/YSVpBGJQ/ART-PRO-2.png" 
                         alt="Art Pro Logo" 
                         class="w-20 h-20 rounded-full shadow-lg pulse-icon"
                         onerror="this.style.display='none';">
                </div>
                <!-- End Logo -->
                
                <div class="flex justify-center items-center mb-4">
                    <span class="sparkle-icon text-2xl ml-2">‚ú®</span>
                    <span class="music-icon text-3xl ml-2">üé∂</span>
                    <span class="float-icon text-2xl ml-2">üå∏</span>
                </div>
                <p class="text-pink-700 text-lg md:text-xl font-medium">·ª®ng d·ª•ng h·ªó tr·ª£ gi√°o vi√™n t·ªï ch·ª©c ki·ªÉm tra chuy√™n nghi·ªáp</p>
            </header>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                <button onclick="selectGrade(6)" class="glass p-6 btn-hover text-pink-700 font-bold text-xl rounded-xl group">
                    <div class="text-4xl mb-3 pulse-icon group-hover:scale-110 transition-transform">üå∫</div>
                    <div class="text-lg">L·ªõp 6</div>
                </button>
                <button onclick="selectGrade(7)" class="glass p-6 btn-hover text-pink-700 font-bold text-xl rounded-xl group">
                    <div class="text-4xl mb-3 float-icon group-hover:scale-110 transition-transform">üå∑</div>
                    <div class="text-lg">L·ªõp 7</div>
                </button>
                <button onclick="selectGrade(8)" class="glass p-6 btn-hover text-pink-700 font-bold text-xl rounded-xl group">
                    <div class="text-4xl mb-3 sparkle-icon group-hover:scale-110 transition-transform">üåπ</div>
                    <div class="text-lg">L·ªõp 8</div>
                </button>
                <button onclick="selectGrade(9)" class="glass p-6 btn-hover text-pink-700 font-bold text-xl rounded-xl group">
                    <div class="text-4xl mb-3 music-icon group-hover:scale-110 transition-transform">üéì</div>
                    <div class="text-lg">L·ªõp 9</div>
                </button>
            </div>
            
            <div class="flex justify-center gap-4">
                <button onclick="showIntroduction()" class="glass px-8 py-4 btn-hover text-pink-700 font-semibold rounded-xl flex items-center gap-2">
                    <span class="pulse-icon">üë®‚Äçüíª</span> Gi·ªõi thi·ªáu
                </button>
            </div>
        </div>

        <!-- M√†n h√¨nh thi·∫øt l·∫≠p -->
        <div id="setupScreen" class="glass p-8 hidden fade-in">
            <header class="text-center mb-8">
                <div class="flex justify-center items-center mb-4">
                    <span class="sparkle-icon text-2xl mr-2">‚öôÔ∏è</span>
                    <span class="float-icon text-2xl ml-2">üå∏</span>
                </div>
                <h2 class="text-3xl fredoka gradient-text mb-2">Thi·∫øt l·∫≠p c·∫•u h√¨nh</h2>
                <p class="text-pink-700 font-medium">Kh·ªëi l·ªõp: <span id="selectedGrade" class="font-bold text-pink-800"></span></p>
            </header>
            
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="glass p-6 rounded-xl">
                    <label for="totalStudents" class="block text-pink-700 font-semibold mb-3 flex items-center gap-2">
                        <span class="pulse-icon">üë•</span> T·ªïng s·ªë h·ªçc sinh:
                    </label>
                    <input type="number" id="totalStudents" min="1" max="50" value="30" 
                           class="w-full p-3 rounded-lg border-0 bg-pink-50/50 text-pink-800 placeholder-pink-400 focus:bg-pink-50/80 focus:outline-none focus:ring-2 focus:ring-pink-300">
                </div>
                
                <div class="glass p-6 rounded-xl">
                    <label for="startNumber" class="block text-pink-700 font-semibold mb-3 flex items-center gap-2">
                        <span class="sparkle-icon">üéØ</span> STT b·∫Øt ƒë·∫ßu:
                    </label>
                    <input type="number" id="startNumber" min="1" value="1" 
                           class="w-full p-3 rounded-lg border-0 bg-pink-50/50 text-pink-800 placeholder-pink-400 focus:bg-pink-50/80 focus:outline-none focus:ring-2 focus:ring-pink-300">
                </div>
                
                <div class="glass p-6 rounded-xl">
                    <label class="block text-pink-700 font-semibold mb-3 flex items-center gap-2">
                        <span class="float-icon">üë´</span> S·ªë h·ªçc sinh m·ªói l∆∞·ª£t:
                    </label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setGroupSize(1)" class="group-btn bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover font-semibold">1</button>
                        <button onclick="setGroupSize(2)" class="group-btn bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover font-semibold">2</button>
                        <button onclick="setGroupSize(3)" class="group-btn bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover font-semibold">3</button>
                        <button onclick="setGroupSize(4)" class="group-btn bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover font-semibold">4</button>
                        <button onclick="setGroupSize(5)" class="group-btn bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover font-semibold">5</button>
                        <button onclick="setGroupSize('random')" class="group-btn bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover font-semibold">
                            <span class="pulse-icon">üé≤</span>
                        </button>
                    </div>
                </div>
                
                <div class="glass p-6 rounded-xl">
                    <label class="block text-pink-700 font-semibold mb-3 flex items-center gap-2">
                        <span class="music-icon">üéµ</span> Ch·ªçn n·ªôi dung:
                    </label>
                    <div class="space-y-3">
                        <button onclick="setContentMode('random')" class="content-btn w-full bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover text-left font-medium flex items-center gap-2">
                            <span class="sparkle-icon">üé≤</span> Ch·ªçn ng·∫´u nhi√™n
                        </button>
                        <button onclick="setContentMode('specific')" class="content-btn w-full bg-pink-100/50 text-pink-700 p-3 rounded-lg btn-hover text-left font-medium flex items-center gap-2">
                            <span class="pulse-icon">üéØ</span> Ch·ªçn c·ª• th·ªÉ
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="specificContent" class="glass p-6 rounded-xl mb-6 hidden">
                <label class="block text-pink-700 font-semibold mb-3 flex items-center gap-2">
                    <span class="float-icon">üìã</span> Ch·ªçn b√†i h√°t:
                </label>
                <select id="songSelect" class="w-full p-3 rounded-lg border-0 bg-pink-50/50 text-pink-800 focus:bg-pink-50/80 focus:outline-none focus:ring-2 focus:ring-pink-300">
                </select>
            </div>
            
            <div class="flex justify-center gap-4">
                <button onclick="goHome()" class="glass px-6 py-3 btn-hover text-pink-700 font-semibold rounded-lg flex items-center gap-2">
                    <span class="float-icon">‚Üê</span> Quay l·∫°i
                </button>
                <button onclick="startExam()" class="bg-gradient-to-r from-pink-400 to-rose-500 px-8 py-3 btn-hover text-white font-bold rounded-lg flex items-center gap-2">
                    <span class="pulse-icon">üöÄ</span> B·∫Øt ƒë·∫ßu ki·ªÉm tra
                </button>
            </div>
        </div>

        <!-- M√†n h√¨nh tr√¨nh chi·∫øu -->
        <div id="examScreen" class="glass p-6 md:p-8 hidden fade-in">
            <header class="text-center mb-4">
                <h2 class="text-3xl fredoka gradient-text" id="examTitle">Ki·ªÉm tra √Çm nh·∫°c</h2>
            </header>
            
            <!-- V√πng hi·ªÉn th·ªã th√¥ng tin nh√≥m v√† ti·∫øn ƒë·ªô (D√πng flex-col tr√™n mobile ƒë·ªÉ tr√°nh k√©o d√†i) -->
            <div class="glass p-3 md:p-4 rounded-xl mb-4">
                <div class="text-pink-700 font-semibold flex flex-col md:flex-row items-center justify-center gap-3 md:gap-6 flex-wrap">
                    <span class="flex items-center gap-1">
                        <span class="pulse-icon text-xl">üë•</span>
                        <span id="currentGroup">Nh√≥m 1</span>
                    </span>
                    <span class="text-pink-400 hidden md:inline">|</span>
                    <!-- Hi·ªÉn th·ªã STT r√µ r√†ng v√† n·ªïi b·∫≠t -->
                    <span class="flex items-center gap-1 font-bold text-rose-600 text-lg">
                        <span class="float-icon text-xl">üìù</span>
                        <span id="studentNumbers">STT H·ªçc sinh: 1-3</span>
                    </span>
                    <span class="text-pink-400 hidden md:inline">|</span>
                    <span class="flex items-center gap-1">
                        <span class="sparkle-icon text-xl">üìä</span>
                        <span id="progress">ƒê√£ ki·ªÉm tra: 0/30</span>
                    </span>
                </div>
            </div>
            
            <!-- V√πng hi·ªÉn th·ªã N·ªôi dung b√†i h√°t v√† Video -->
            <div class="glass p-4 rounded-xl mb-6 text-center">
                
                <!-- T√™n B√†i H√°t (ƒë√£ x√≥a ƒë·ªÅ b√†i ki·ªÉm tra) -->
                <p class="text-xl text-pink-600 font-medium mb-1">Em h√£y tr√¨nh b√†y b√†i:</p>

                <div class="flex justify-center items-center mb-3">
                    <span class="music-icon text-2xl mr-2">üé∂</span>
                    <h4 class="text-3xl font-extrabold fredoka text-rose-700" id="currentSong">ƒêang t·∫£i...</h4>
                    <span class="music-icon text-2xl ml-2">üé∂</span>
                </div>
                
                <div id="videoContainer" class="aspect-video bg-gradient-to-br from-pink-100/30 to-rose-100/30 rounded-xl overflow-hidden border-2 border-pink-200/50 relative">
                    <iframe id="youtubePlayer" width="100%" height="100%" frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen></iframe>
                </div>
            </div>
            
            <!-- V√πng ƒëi·ªÅu khi·ªÉn (N√∫t b·∫•m) -->
            <div class="flex justify-center gap-3 flex-wrap">
                <!-- N√∫t Start Video -->
                <button onclick="startVideo()" class="start-video-btn px-6 py-3 btn-hover flex items-center gap-2 text-sm md:text-base">
                    <span class="pulse-icon">‚ñ∂Ô∏è</span> B·∫Øt ƒë·∫ßu Video (M·ªü √¢m thanh)
                </button>
                
                <button onclick="previousGroup()" class="glass px-4 py-3 btn-hover text-pink-700 font-semibold rounded-lg flex items-center gap-2 text-sm md:text-base" id="prevBtn">
                    <span class="float-icon">‚Üê</span> Nh√≥m tr∆∞·ªõc
                </button>
                <button onclick="nextGroup()" class="bg-gradient-to-r from-pink-400 to-rose-500 px-6 py-3 btn-hover text-white font-bold rounded-lg flex items-center gap-2 text-sm md:text-base" id="nextBtn">
                    Nh√≥m ti·∫øp theo <span class="pulse-icon">‚Üí</span>
                </button>
                <button onclick="goHome()" class="glass px-4 py-3 btn-hover text-pink-700 font-semibold rounded-lg flex items-center gap-2 text-sm md:text-base">
                    <span class="sparkle-icon">üè†</span> Trang ch·ªß
                </button>
            </div>
        </div>

        <!-- M√†n h√¨nh k·∫øt th√∫c -->
        <div id="finishScreen" class="glass p-8 text-center hidden fade-in">
            <div class="flex justify-center items-center mb-6">
                <span class="sparkle-icon text-4xl mr-2">üéâ</span>
                <span class="pulse-icon text-5xl mx-2">üèÜ</span>
                <span class="sparkle-icon text-4xl ml-2">üéâ</span>
            </div>
            <h2 class="text-4xl fredoka gradient-text mb-4">Ch√∫c m·ª´ng!</h2>
            <p class="text-pink-700 text-xl font-medium mb-8">ƒê√£ ho√†n th√†nh ki·ªÉm tra cho t·∫•t c·∫£ h·ªçc sinh</p>
            <div class="flex justify-center items-center gap-3 mb-8">
                <span class="music-icon text-3xl">üéµ</span>
                <span class="float-icon text-3xl">üé∂</span>
                <span class="pulse-icon text-3xl">üé§</span>
                <span class="sparkle-icon text-3xl">üé∏</span>
                <span class="music-icon text-3xl">üéπ</span>
            </div>
            <button onclick="goHome()" class="bg-gradient-to-r from-pink-400 to-rose-500 px-8 py-4 btn-hover text-white font-bold rounded-xl text-xl flex items-center gap-2 mx-auto">
                <span class="pulse-icon">üè†</span> V·ªÅ trang ch·ªß
            </button>
        </div>

        <!-- M√†n h√¨nh gi·ªõi thi·ªáu -->
        <div id="introductionScreen" class="glass p-8 hidden fade-in max-h-screen overflow-y-auto">
            <header class="text-center mb-8">
                <div class="flex justify-center items-center mb-6">
                    <img src="https://i.postimg.cc/YSVpBGJQ/ART-PRO-2.png" 
                         alt="Art Pro Logo" 
                         class="w-20 h-20 rounded-full shadow-lg pulse-icon"
                         onerror="this.style.display='none';">
                </div>
                <h2 class="text-3xl fredoka gradient-text mb-2">Gi·ªõi thi·ªáu</h2>
                <p class="text-pink-700 font-medium">·ª®ng d·ª•ng Ki·ªÉm tra √Çm nh·∫°c</p>
            </header>
            
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- Th√¥ng tin t√°c gi·∫£ -->
                <div class="glass p-6 rounded-xl text-center">
                    <div class="flex justify-center items-center mb-4">
                        <span class="sparkle-icon text-3xl mr-2">üë®‚Äçüíª</span>
                        <span class="pulse-icon text-3xl ml-2">‚ú®</span>
                    </div>
                    <h3 class="text-2xl font-bold text-pink-700 mb-3">Ng∆∞·ªùi t·∫°o</h3>
                    <div class="text-3xl fredoka gradient-text mb-3">Tu·∫•n Anh</div>
                    <p class="text-pink-600 font-medium mb-4">Developer & Educator</p>
                    <div class="flex justify-center items-center gap-2 text-pink-600">
                        <span class="music-icon">üéµ</span>
                        <span>Chuy√™n gia gi√°o d·ª•c √¢m nh·∫°c</span>
                        <span class="music-icon">üéµ</span>
                    </div>
                </div>
                
                <!-- QR Code ·ªßng h·ªô -->
                <div class="glass p-6 rounded-xl text-center">
                    <div class="flex justify-center items-center mb-4">
                        <span class="float-icon text-2xl mr-2">üíù</span>
                        <span class="sparkle-icon text-2xl ml-2">üôè</span>
                    </div>
                    <h3 class="text-xl font-bold text-pink-700 mb-4">·ª¶ng h·ªô t√°c gi·∫£</h3>
                    <div class="mb-4">
                        <img src="https://i.postimg.cc/WzN1bBJy/QR-TUAN-ANH.png" 
                             alt="QR Code ·ªßng h·ªô" 
                             class="w-32 h-32 mx-auto rounded-lg shadow-lg pulse-icon"
                             onerror="this.style.display='none';">
                    </div>
                    <p class="text-pink-600 text-sm mb-3">Qu√©t m√£ QR ƒë·ªÉ ·ªßng h·ªô</p>
                    <a href="https://i.postimg.cc/WzN1bBJy/QR-TUAN-ANH.png" 
                       download="QR-UNG-HO-TUAN-ANH.png"
                       class="glass px-4 py-2 btn-hover text-pink-700 font-semibold rounded-lg inline-flex items-center gap-2 text-sm">
                        <span class="sparkle-icon">üì±</span> T·∫£i QR Code
                    </a>
                </div>
            </div>
            
            <!-- T√≠nh nƒÉng ·ª©ng d·ª•ng -->
            <div class="glass p-6 rounded-xl mb-6">
                <h3 class="text-xl font-bold text-pink-700 mb-4 text-center flex items-center justify-center gap-2">
                    <span class="music-icon">üéØ</span> T√≠nh nƒÉng n·ªïi b·∫≠t
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="flex items-center gap-3 p-3 bg-pink-50/30 rounded-lg">
                        <span class="pulse-icon text-2xl">üéµ</span>
                        <span class="text-pink-700 font-medium">T√≠ch h·ª£p video karaoke</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-pink-50/30 rounded-lg">
                        <span class="sparkle-icon text-2xl">üë•</span>
                        <span class="text-pink-700 font-medium">Qu·∫£n l√Ω nh√≥m linh ho·∫°t</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-pink-50/30 rounded-lg">
                        <span class="float-icon text-2xl">üì±</span>
                        <span class="text-pink-700 font-medium">Giao di·ªán th√¢n thi·ªán</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-pink-50/30 rounded-lg">
                        <span class="music-icon text-2xl">‚ö°</span>
                        <span class="text-pink-700 font-medium">Hi·ªáu su·∫•t cao</span>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="goHome()" class="glass px-6 py-3 btn-hover text-pink-700 font-semibold rounded-lg flex items-center gap-2 mx-auto">
                    <span class="float-icon">‚Üê</span> Quay l·∫°i trang ch·ªß
                </button>
            </div>
        </div>
    </main>

    <script>
        // D·ªØ li·ªáu b√†i h√°t theo kh·ªëi l·ªõp ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
        const songData = {
            6: [
                { name: "Em y√™u gi·ªù h·ªçc h√°t", id: "YWpjl-U2Ab0" },
                { name: "B√†i ƒë·ªçc nh·∫°c s·ªë 1 l·ªõp 6", id: "wNQ5lMJoUtI" },
                { name: "L√Ω c√¢y ƒëa", id: "AM-9EtA2OxM" }
            ],
            7: [
                { name: "∆Ø·ªõc m∆° m√πa khai tr∆∞·ªùng", id: "pu5flmJvREE" },
                { name: "B√†i ƒë·ªçc nh·∫°c s·ªë 1 l·ªõp 7", id: "XgvauCD74w4" },
                { name: "ƒêi c·∫•y", id: "ASZ0mBgg9Oo" }
            ],
            8: [
                { name: "Kh√∫c ca b·ªën m√πa", id: "A8zp5xLFt7I" },
                { name: "B√†i ƒë·ªçc nh·∫°c s·ªë 1 l·ªõp 8", id: "eRe4ZSpaDGM" },
                { name: "B·∫£n l√†ng t∆∞∆°i ƒë·∫πp", id: "hP0e5La7pYY" }
            ],
            9: [
                { name: "Tu·ªïi m∆∞·ªùi lƒÉm", id: "DQrB7v0W9nk" },
                { name: "B√†i ƒë·ªçc nh·∫°c s·ªë 1 l·ªõp 9", id: "kpFX0nVZ55Y" },
                { name: "Qu√™ h∆∞∆°ng thanh b√¨nh", id: "imS6uiDjkag" }
            ]
        };

        // Bi·∫øn tr·∫°ng th√°i
        let currentGrade = null;
        let totalStudents = 30;
        let startNumber = 1;
        let groupSize = 1;
        let contentMode = 'random';
        let selectedSong = null;
        let currentGroupIndex = 0;
        let groups = [];
        let currentVideoId = null; // Th√™m bi·∫øn l∆∞u ID video hi·ªán t·∫°i

        // Hi·ªÉn th·ªã m√†n h√¨nh
        function showScreen(screenId) {
            const screens = ['loadingScreen', 'homeScreen', 'setupScreen', 'examScreen', 'finishScreen', 'introductionScreen'];
            screens.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            document.getElementById(screenId).classList.add('fade-in');
        }

        // Ch·ªçn kh·ªëi l·ªõp
        function selectGrade(grade) {
            currentGrade = grade;
            document.getElementById('selectedGrade').textContent = `L·ªõp ${grade}`;
            
            // C·∫≠p nh·∫≠t danh s√°ch b√†i h√°t
            const songSelect = document.getElementById('songSelect');
            songSelect.innerHTML = '';
            songData[grade].forEach(song => {
                const option = document.createElement('option');
                option.value = song.id;
                option.textContent = song.name;
                songSelect.appendChild(option);
            });
            
            showScreen('setupScreen');
        }

        // Thi·∫øt l·∫≠p k√≠ch th∆∞·ªõc nh√≥m
        function setGroupSize(size) {
            groupSize = size;
            document.querySelectorAll('.group-btn').forEach(btn => {
                btn.classList.remove('bg-pink-400', 'text-white');
                btn.classList.add('bg-pink-100/50', 'text-pink-700');
            });
            // S·ª≠ d·ª•ng event.target ƒë·ªÉ l·∫•y n√∫t ƒë∆∞·ª£c click
            const target = event.target.closest('button');
            if (target) {
                target.classList.remove('bg-pink-100/50', 'text-pink-700');
                target.classList.add('bg-pink-400', 'text-white');
            }
        }

        // Thi·∫øt l·∫≠p ch·∫ø ƒë·ªô n·ªôi dung
        function setContentMode(mode) {
            contentMode = mode;
            document.querySelectorAll('.content-btn').forEach(btn => {
                btn.classList.remove('bg-pink-400', 'text-white');
                btn.classList.add('bg-pink-100/50', 'text-pink-700');
            });
            // S·ª≠ d·ª•ng event.target ƒë·ªÉ l·∫•y n√∫t ƒë∆∞·ª£c click
            const target = event.target.closest('button');
            if (target) {
                target.classList.remove('bg-pink-100/50', 'text-pink-700');
                target.classList.add('bg-pink-400', 'text-white');
            }
            
            const specificContent = document.getElementById('specificContent');
            if (mode === 'specific') {
                specificContent.classList.remove('hidden');
            } else {
                specificContent.classList.add('hidden');
            }
        }

        // T·∫°o nh√≥m h·ªçc sinh
        function createGroups() {
            groups = [];
            totalStudents = parseInt(document.getElementById('totalStudents').value) || 0;
            startNumber = parseInt(document.getElementById('startNumber').value) || 1;
            
            if (totalStudents <= 0 || startNumber <= 0 || startNumber > totalStudents) {
                // X·ª≠ l√Ω l·ªói n·∫øu d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá
                console.error("D·ªØ li·ªáu h·ªçc sinh kh√¥ng h·ª£p l·ªá.");
                return;
            }

            let currentStudent = startNumber;
            
            while (currentStudent <= totalStudents) {
                const currentGroupSize = groupSize === 'random' ? 
                    Math.min(Math.floor(Math.random() * 5) + 1, totalStudents - currentStudent + 1) : 
                    Math.min(groupSize, totalStudents - currentStudent + 1);
                
                const group = [];
                for (let i = 0; i < currentGroupSize; i++) {
                    group.push(currentStudent);
                    currentStudent++;
                }
                
                if (group.length > 0) {
                    groups.push(group);
                }
            }
        }

        // B·∫Øt ƒë·∫ßu ki·ªÉm tra
        function startExam() {
            createGroups();
            currentGroupIndex = 0;
            
            if (contentMode === 'specific') {
                const songSelect = document.getElementById('songSelect');
                const selectedId = songSelect.value;
                selectedSong = songData[currentGrade].find(song => song.id === selectedId);
            }
            
            if (groups.length === 0) {
                 // ƒê√¢y l√† n∆°i b·∫°n s·∫Ω hi·ªÉn th·ªã m·ªôt th√¥ng b√°o thay v√¨ alert()
                 console.error("Kh√¥ng c√≥ h·ªçc sinh n√†o ƒë·ªÉ ki·ªÉm tra. Vui l√≤ng ki·ªÉm tra l·∫°i thi·∫øt l·∫≠p.");
                 return;
            }

            showScreen('examScreen');
            updateExamDisplay();
        }

        // B·∫Øt ƒë·∫ßu ph√°t video (c√≥ ti·∫øng)
        function startVideo() {
            if (currentVideoId) {
                const iframe = document.getElementById('youtubePlayer');
                // T·∫£i l·∫°i iframe v·ªõi autoplay=1 v√† mute=0 (m·ªü ti·∫øng)
                iframe.src = `https://www.youtube.com/embed/${currentVideoId}?autoplay=1&rel=0`;
            }
        }


        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã ki·ªÉm tra
        function updateExamDisplay() {
            if (currentGroupIndex >= groups.length) {
                showScreen('finishScreen');
                return;
            }
            
            const currentGroup = groups[currentGroupIndex];
            
            // Ch·ªçn b√†i h√°t: ng·∫´u nhi√™n ho·∫∑c c·ª• th·ªÉ
            let song;
            if (contentMode === 'random') {
                const songs = songData[currentGrade];
                song = songs[Math.floor(Math.random() * songs.length)]; 
            } else {
                // ƒê·∫£m b·∫£o selectedSong ƒë∆∞·ª£c ƒë·∫∑t ƒë√∫ng
                song = selectedSong; 
            }

            // L∆∞u ID video hi·ªán t·∫°i
            currentVideoId = song ? song.id : null;

            // C·∫≠p nh·∫≠t th√¥ng tin tr√™n m√†n h√¨nh
            document.getElementById('currentGroup').textContent = `Nh√≥m ${currentGroupIndex + 1}`;
            // C·∫≠p nh·∫≠t STT r√µ r√†ng h∆°n
            document.getElementById('studentNumbers').textContent = `STT H·ªçc sinh: ${currentGroup.join(', ')}`;
            
            // T√≠nh to√°n s·ªë h·ªçc sinh ƒë√£ ki·ªÉm tra
            let checkedStudents = 0;
            for(let i = 0; i <= currentGroupIndex; i++) {
                checkedStudents += groups[i].length;
            }
            document.getElementById('progress').textContent = 
                `ƒê√£ ki·ªÉm tra: ${checkedStudents}/${totalStudents}`;

            document.getElementById('currentSong').textContent = song ? song.name : "Kh√¥ng t√¨m th·∫•y b√†i h√°t";
            
            // C·∫≠p nh·∫≠t video YouTube (Kh√¥ng Autoplay ban ƒë·∫ßu)
            const iframe = document.getElementById('youtubePlayer');
            if (currentVideoId) {
                 // Kh√¥ng th√™m tham s·ªë autoplay ƒë·ªÉ video kh√¥ng t·ª± ƒë·ªông ph√°t
                iframe.src = `https://www.youtube.com/embed/${currentVideoId}?rel=0`;
            } else {
                iframe.src = ''; // Clear iframe if no song is found
            }
            
            // C·∫≠p nh·∫≠t n√∫t ƒëi·ªÅu h∆∞·ªõng
            document.getElementById('prevBtn').style.display = currentGroupIndex === 0 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').textContent = 
                currentGroupIndex === groups.length - 1 ? 'K·∫øt th√∫c' : 'Nh√≥m ti·∫øp theo ‚Üí';
        }

        // Nh√≥m ti·∫øp theo
        function nextGroup() {
            currentGroupIndex++;
            updateExamDisplay();
        }

        // Nh√≥m tr∆∞·ªõc
        function previousGroup() {
            if (currentGroupIndex > 0) {
                currentGroupIndex--;
                updateExamDisplay();
            }
        }

        // V·ªÅ trang ch·ªß
        function goHome() {
            // D·ª´ng video ƒëang ph√°t tr∆∞·ªõc khi v·ªÅ trang ch·ªß
            const iframe = document.getElementById('youtubePlayer');
            iframe.src = ''; 
            
            showScreen('homeScreen');
            // Reset tr·∫°ng th√°i
            currentGrade = null;
            currentGroupIndex = 0;
            groups = [];
            currentVideoId = null;
        }

        // Hi·ªÉn th·ªã gi·ªõi thi·ªáu
        function showIntroduction() {
            showScreen('introductionScreen');
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            // Hi·ªÉn th·ªã m√†n h√¨nh loading tr∆∞·ªõc
            showScreen('loadingScreen');
            
            // Sau 3.5 gi√¢y chuy·ªÉn sang m√†n h√¨nh ch√≠nh
            setTimeout(() => {
                showScreen('homeScreen');
                // Thi·∫øt l·∫≠p gi√° tr·ªã m·∫∑c ƒë·ªãnh cho UI
                // K√≠ch ho·∫°t n√∫t m·∫∑c ƒë·ªãnh cho Group Size (1)
                const defaultGroupBtn = document.querySelector('.group-btn:nth-child(1)');
                if (defaultGroupBtn) {
                     defaultGroupBtn.classList.remove('bg-pink-100/50', 'text-pink-700');
                     defaultGroupBtn.classList.add('bg-pink-400', 'text-white');
                }
                // K√≠ch ho·∫°t n√∫t m·∫∑c ƒë·ªãnh cho Content Mode (random)
                const randomContentBtn = document.querySelector('.content-btn:nth-child(1)');
                 if (randomContentBtn) {
                     randomContentBtn.classList.remove('bg-pink-100/50', 'text-pink-700');
                     randomContentBtn.classList.add('bg-pink-400', 'text-white');
                }
            }, 3500);
        });
    </script>
</body>
</html>

